package edu.ace.infinite;

import edu.ace.infinite.utils.HttpUtils;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
import org.json.JSONArray;
import org.json.JSONObject;
import org.junit.jupiter.api.Test;
import org.omg.CORBA.UserException;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpHeaders;
import org.springframework.web.reactive.function.client.ClientResponse;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.core.publisher.Mono;
import reactor.util.function.Tuple2;

import java.io.IOException;
import java.net.URI;
import java.util.Objects;

@SpringBootTest
class InfiniteApplicationTests {

    @Test
    void test01(){
        Request request = new Request.Builder()
                .url("https://www.douyin.com/aweme/v1/web/tab/feed/?device_platform=webapp&aid=6383&channel=channel_pc_web&tag_id=&share_aweme_id=&live_insert_type=&count=10&refresh_index=2&video_type_select=1&aweme_pc_rec_raw_data=%7B%22is_client%22%3Afalse%2C%22ff_danmaku_status%22%3A1%2C%22danmaku_switch_status%22%3A1%2C%22is_dash_user%22%3A1%2C%22is_auto_play%22%3A0%2C%22is_full_screen%22%3A0%2C%22is_full_webscreen%22%3A0%2C%22is_mute%22%3A1%2C%22is_speed%22%3A1%2C%22is_visible%22%3A1%2C%22related_recommend%22%3A1%7D&globalwid=7395471247238809125&pull_type=2&min_window=0&free_right=0&view_count=2&plug_block=0&ug_source=&creative_id=&pc_client_type=1&pc_libra_divert=Windows&version_code=170400&version_name=17.4.0&cookie_enabled=true&screen_width=1536&screen_height=864&browser_language=zh-CN&browser_platform=Win32&browser_name=Chrome&browser_version=131.0.0.0&browser_online=true&engine_name=Blink&engine_version=131.0.0.0&os_name=Windows&os_version=10&cpu_core_num=16&device_memory=8&platform=PC&downlink=1.35&effective_type=4g&round_trip_time=250&webid=7395471247238809125&verifyFp=verify_m3cssxot_nGMCjVUb_AS8M_4Uk4_95fx_ilcrcqL9qPOL&fp=verify_m3cssxot_nGMCjVUb_AS8M_4Uk4_95fx_ilcrcqL9qPOL&msToken=tUEoZmFoNzrzMOQ-HszJ4YzXdIJbasy-6CA2tTOGS-78pyPwV8qQ7dECg3sdDp9AY0NYCo-SQsfH4-IRrlDaYCyJNEAick6pbRtcP1XqnpRmFD7yA6FANG0Qt_J0bFeyqhEMDoq5phZrL5syxkKmF-pgaccOh01RhheqcS7vwa7HPn9sC1iE&a_bogus=Q7UVDqWEmo8bKdKbucbUC4pUAoIANPuyZZixWP5TtNYPY10csWPwiNSsnxwHv6LZamBshC3HbdzAbxncMGXkZqnpLmpvSuTbUU259h0ogqwXGUs%2FgqWDS8UzFwsC0QiNa59aEIhRIs0r2nVRIHVFlQBG95zo5cDgRHBAp%2Ft9GDC83T6T99%2F4CcTWhHE%3D")
                .addHeader("user-agent", HttpUtils.randomUA("windows"))
                .addHeader("accept","application/json, text/plain, */*")
                .addHeader("accept-language","zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6")
                .addHeader("sec-ch-ua","\"Not A(Brand\";v=\"99\", \"Microsoft Edge\";v=\"121\", \"Chromium\";v=\"121\"")
                .addHeader("priority","u=1, i")
                .addHeader("sec-ch-ua-mobile","?0")
                .addHeader("sec-ch-ua-platform","\"Windows\"")
                .addHeader("sec-fetch-dest","empty")
                .addHeader("sec-fetch-mode","cors")
                .addHeader("sec-fetch-site","same-origin")
//                .addHeader("cookie","ttwid=1%7Cy7-wgq699S5dfD3cwmlihWBJ_k0Itkr-EhSSy1ZQ5wM%7C1721892345%7C234d8ba0bcc10dea1d6ab0ab7a9bd962dba04ed5175a8984b6c9a9a7e806d891; UIFID_TEMP=3c3e9d4a635845249e00419877a3730e2149197a63ddb1d8525033ea2b3354c2e13a8efc0737ffdb2d89b7f1396ae6c753d3a0e928e7576fb849b056e7a885fcb63e9a3de8ac0b28abd5426aa3f636c7168f4f248c11fae9869f7c8b6082cae453e94e92e37e23457464bc55a8fe8c05; fpk1=U2FsdGVkX19bRxdI0zJSdj879yBkQRM79FHi8KsM4e84X+//P6tK2h00CuPmjvonC846JvHB/+fa8THZFHCPfg==; fpk2=f1f6b29a6cc1f79a0fea05b885aa33d0; SEARCH_RESULT_LIST_TYPE=%22single%22; xgplayer_user_id=573747585579; UIFID=3c3e9d4a635845249e00419877a3730e2149197a63ddb1d8525033ea2b3354c27408bce5219e2fa374624a4a7620947f974234b76297772ac00c7416492af1039e558600e8a3593470cfe202bd0fefe8ac898fd5b454621e5173c2d27d846be44ffa2b919fa8f5e5547f703b6473c9706347ff45f748057592eb17da050ecd7152db10c65a1594346daa429705768d766d348c8f0774538707d499a9c0810d126b829f2987a6bd53c65dd992224cbdbf7aebd8f07738e7560534ebcc40e4a9b5; hevc_supported=true; s_v_web_id=verify_m3cssxot_nGMCjVUb_AS8M_4Uk4_95fx_ilcrcqL9qPOL; passport_csrf_token=05dde154ea4260d0166c150067be65c3; passport_csrf_token_default=05dde154ea4260d0166c150067be65c3; bd_ticket_guard_client_web_domain=2; douyin.com; is_dash_user=1; device_web_cpu_core=16; device_web_memory_size=8; architecture=amd64; dy_swidth=1536; dy_sheight=864; csrf_session_id=7f156f9edc3de0f10fb757bcbb1e6e37; strategyABtestKey=%221733124841.361%22; FORCE_LOGIN=%7B%22videoConsumedRemainSeconds%22%3A180%7D; volume_info=%7B%22isUserMute%22%3Afalse%2C%22isMute%22%3Atrue%2C%22volume%22%3A0.5%7D; download_guide=%223%2F20241202%2F0%22; __ac_signature=_02B4Z6wo00f01yPvWWQAAIDC.LSqKim4skMjz13AAK.Bef; gulu_source_res=eyJwX2luIjoiNGEyZmE1ZTg5YTg1M2ViNDJiOTRmMzNjODI3MThlYzAyMDdmNDc5ZjdhYTgxNmE5ZjlmZmNjNmI3OGFhZWZmNiJ9; sdk_source_info=7e276470716a68645a606960273f276364697660272927676c715a6d6069756077273f276364697660272927666d776a68605a607d71606b766c6a6b5a7666776c7571273f275e58272927666a6b766a69605a696c6061273f27636469766027292762696a6764695a7364776c6467696076273f275e5827292771273f273d343436373d3c373436363234272927676c715a75776a716a666a69273f2763646976602778; bit_env=tfkR43oc1TAbZyNv1ysXe1mIZJJTAPiuBvFM3OcXRxafq-_8LeYuvKJi-Ls-S10sOCW5gbNnWa-hRCnizl5KfWNWuGUTI3pnt7nbyBdoZUeKNpXqpaIfGowhLvO7vintwvBscYd-tPkya4bkPgbZ4m5RPRnLH4d9ttJsbhHFeBuT8lJFTgGKPJUgjfDSrcl8txaFQ7l80Ef1ICSOtkoBiJF4PhEIXu4sS9zIHfcLXsbr34t2ikmEOlSJiuZyn_ZPimfFGORNXHLULx8pkBJsx2dgsQRQ42fsCb3CNtita8xJDnlI9eKq1AB_Lmnb2OHoYsYwWMiNlx7qyFIsjC2YWq9S8_4gXzTBvTRZdIQILf30bdrljnl3jWM6dZTsbW-JbwM0FoHtdmUB0dGI05RHdBA9jh7Ehsn1EzOVmmYNBphHKsjL7oloIVhy-8yC-0ToVhthOtNWPbvj7JNpQPGDKL4myam-ZwSKu_XJvmzn7LiRs5HucuD2Y8aeASy3BH6G; passport_auth_mix_state=l77prm6nsshqvnosgn6phiguctwozx2h; passport_mfa_token=CjUpVNetvpB8Zr1jZ2tbtInUu38uUWEvjROrAsVcmkMpmk9I5M8B0mNz0oEvbuGjuQF1CQtF4BpKCjwtGudUs%2BSswQPE11KonfIvva%2BR7rYcYQCWQbosDQsJqBhxE752x56MMscPL1VmmkDXmaqHZlDWDiOVutQQr4PjDRj2sdFsIAIiAQOcqBrs; d_ticket=ddee2028b8cf6666247e3c9272741fbdf9b5c; passport_assist_user=Cj2R92G3UV6xb-jmf4xxvJn9rGYhyqNoeb5ZSpOx_Q2bucZ4dHqM4hzWGUF-w-LjdYFC6pf-RxnE4DMztLwyGkoKPOe34cqvpZUziLeaq-Xv5U9l4jR_cjtOyCIoRKlgiVWeVaaM8cxcxAt5-eVtr1Oft8zr4nnFdghJhgLFZhDlguMNGImv1lQgASIBA9NkpvA%3D; n_mh=uMdSiFmP8i2dWj6705vGWkn9--naSG-Lx121BtF2X_U; sso_uid_tt=5783a2886eed7c61f2db7d24b6c405de; sso_uid_tt_ss=5783a2886eed7c61f2db7d24b6c405de; toutiao_sso_user=e3c58d87b0bad2ebe435a00058dfdd0c; toutiao_sso_user_ss=e3c58d87b0bad2ebe435a00058dfdd0c; sid_ucp_sso_v1=1.0.0-KGMzNDY2ODNkYzM3N2UyMTk5ZmU2ZjE2MTcyNmJlNTdjNGFhOGY3YWUKHwiqiJL99wIQl-21ugYY7zEgDDCNotLZBTgGQPQHSAYaAmxxIiBlM2M1OGQ4N2IwYmFkMmViZTQzNWEwMDA1OGRmZGQwYw; ssid_ucp_sso_v1=1.0.0-KGMzNDY2ODNkYzM3N2UyMTk5ZmU2ZjE2MTcyNmJlNTdjNGFhOGY3YWUKHwiqiJL99wIQl-21ugYY7zEgDDCNotLZBTgGQPQHSAYaAmxxIiBlM2M1OGQ4N2IwYmFkMmViZTQzNWEwMDA1OGRmZGQwYw; login_time=1733129879643; passport_auth_status=52cb51f862f9f9b8ebaf0776aa492051%2C; passport_auth_status_ss=52cb51f862f9f9b8ebaf0776aa492051%2C; uid_tt=a68f5506ce7d5e57aebf0fa0e442282f; uid_tt_ss=a68f5506ce7d5e57aebf0fa0e442282f; sid_tt=b1a080f6bf22a258d2e4b56893e0be43; sessionid=b1a080f6bf22a258d2e4b56893e0be43; sessionid_ss=b1a080f6bf22a258d2e4b56893e0be43; is_staff_user=false; __ac_nonce=0674d769900d5331733a5; SelfTabRedDotControl=%5B%5D; FOLLOW_LIVE_POINT_INFO=%22MS4wLjABAAAASmPmcSDRbNaw1E1RDCQkwWeYoTNcpq02bL4GM1_9u_Y%2F1733155200000%2F0%2F1733129894052%2F0%22; _bd_ticket_crypt_doamin=2; _bd_ticket_crypt_cookie=74e5bf5e06aeb90df2e2297b72556239; __security_server_data_status=1; publish_badge_show_info=%220%2C0%2C0%2C1733129895728%22; xg_device_score=7.90435294117647; sid_guard=b1a080f6bf22a258d2e4b56893e0be43%7C1733129897%7C5183985%7CFri%2C+31-Jan-2025+08%3A58%3A02+GMT; sid_ucp_v1=1.0.0-KDZmZmY2Yjc3OTE2NzYyMDBhNjkzYjgwOGIwMDg0ZTIwNjA1YTJmNzMKGQiqiJL99wIQqe21ugYY7zEgDDgGQPQHSAQaAmxxIiBiMWEwODBmNmJmMjJhMjU4ZDJlNGI1Njg5M2UwYmU0Mw; ssid_ucp_v1=1.0.0-KDZmZmY2Yjc3OTE2NzYyMDBhNjkzYjgwOGIwMDg0ZTIwNjA1YTJmNzMKGQiqiJL99wIQqe21ugYY7zEgDDgGQPQHSAQaAmxxIiBiMWEwODBmNmJmMjJhMjU4ZDJlNGI1Njg5M2UwYmU0Mw; biz_trace_id=2826297d; store-region=cn-sc; store-region-src=uid; IsDouyinActive=true; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1536%2C%5C%22screen_height%5C%22%3A864%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A16%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A10%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A100%7D%22; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCS2YzdFFHZ3RBaU9ReGlkcDlKeTVmc3pGSit3T01KWTV2MUk0VXZoMGlHekl3TUovcWhkU0JtUW1UUWxsOWxyWmhyMG1ZZkpjZ2kwQ3Foa2ZRcDVac0E9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoyfQ%3D%3D; passport_fe_beating_status=true; stream_player_status_params=%22%7B%5C%22is_auto_play%5C%22%3A0%2C%5C%22is_full_screen%5C%22%3A0%2C%5C%22is_full_webscreen%5C%22%3A0%2C%5C%22is_mute%5C%22%3A1%2C%5C%22is_speed%5C%22%3A1%2C%5C%22is_visible%5C%22%3A1%7D%22; home_can_add_dy_2_desktop=%221%22; odin_tt=7ea8d2b5a709e547be1dc6228fbb1f6042a13e8e141089d96afc69ad3a4e50cc04bd21b49ef106f9d9b4a07724aca74c")
                .addHeader("cookie","ttwid=1%7Cy7-wgq699S5dfD3cwmlihWBJ_k0Itkr-EhSSy1ZQ5wM%7C1721892345%7C234d8ba0bcc10dea1d6ab0ab7a9bd962dba04ed5175a8984b6c9a9a7e806d891; UIFID_TEMP=3c3e9d4a635845249e00419877a3730e2149197a63ddb1d8525033ea2b3354c2e13a8efc0737ffdb2d89b7f1396ae6c753d3a0e928e7576fb849b056e7a885fcb63e9a3de8ac0b28abd5426aa3f636c7168f4f248c11fae9869f7c8b6082cae453e94e92e37e23457464bc55a8fe8c05; fpk1=U2FsdGVkX19bRxdI0zJSdj879yBkQRM79FHi8KsM4e84X+//P6tK2h00CuPmjvonC846JvHB/+fa8THZFHCPfg==; fpk2=f1f6b29a6cc1f79a0fea05b885aa33d0; SEARCH_RESULT_LIST_TYPE=%22single%22; xgplayer_user_id=573747585579; UIFID=3c3e9d4a635845249e00419877a3730e2149197a63ddb1d8525033ea2b3354c27408bce5219e2fa374624a4a7620947f974234b76297772ac00c7416492af1039e558600e8a3593470cfe202bd0fefe8ac898fd5b454621e5173c2d27d846be44ffa2b919fa8f5e5547f703b6473c9706347ff45f748057592eb17da050ecd7152db10c65a1594346daa429705768d766d348c8f0774538707d499a9c0810d126b829f2987a6bd53c65dd992224cbdbf7aebd8f07738e7560534ebcc40e4a9b5; hevc_supported=true; s_v_web_id=verify_m3cssxot_nGMCjVUb_AS8M_4Uk4_95fx_ilcrcqL9qPOL; passport_csrf_token=05dde154ea4260d0166c150067be65c3; passport_csrf_token_default=05dde154ea4260d0166c150067be65c3; bd_ticket_guard_client_web_domain=2; douyin.com; is_dash_user=1; device_web_cpu_core=16; device_web_memory_size=8; architecture=amd64; dy_swidth=1536; dy_sheight=864; csrf_session_id=7f156f9edc3de0f10fb757bcbb1e6e37; strategyABtestKey=%221733124841.361%22; FORCE_LOGIN=%7B%22videoConsumedRemainSeconds%22%3A180%7D; volume_info=%7B%22isUserMute%22%3Afalse%2C%22isMute%22%3Atrue%2C%22volume%22%3A0.5%7D; download_guide=%223%2F20241202%2F0%22; __ac_signature=_02B4Z6wo00f01yPvWWQAAIDC.LSqKim4skMjz13AAK.Bef; gulu_source_res=eyJwX2luIjoiNGEyZmE1ZTg5YTg1M2ViNDJiOTRmMzNjODI3MThlYzAyMDdmNDc5ZjdhYTgxNmE5ZjlmZmNjNmI3OGFhZWZmNiJ9; sdk_source_info=7e276470716a68645a606960273f276364697660272927676c715a6d6069756077273f276364697660272927666d776a68605a607d71606b766c6a6b5a7666776c7571273f275e58272927666a6b766a69605a696c6061273f27636469766027292762696a6764695a7364776c6467696076273f275e5827292771273f273d343436373d3c373436363234272927676c715a75776a716a666a69273f2763646976602778; bit_env=tfkR43oc1TAbZyNv1ysXe1mIZJJTAPiuBvFM3OcXRxafq-_8LeYuvKJi-Ls-S10sOCW5gbNnWa-hRCnizl5KfWNWuGUTI3pnt7nbyBdoZUeKNpXqpaIfGowhLvO7vintwvBscYd-tPkya4bkPgbZ4m5RPRnLH4d9ttJsbhHFeBuT8lJFTgGKPJUgjfDSrcl8txaFQ7l80Ef1ICSOtkoBiJF4PhEIXu4sS9zIHfcLXsbr34t2ikmEOlSJiuZyn_ZPimfFGORNXHLULx8pkBJsx2dgsQRQ42fsCb3CNtita8xJDnlI9eKq1AB_Lmnb2OHoYsYwWMiNlx7qyFIsjC2YWq9S8_4gXzTBvTRZdIQILf30bdrljnl3jWM6dZTsbW-JbwM0FoHtdmUB0dGI05RHdBA9jh7Ehsn1EzOVmmYNBphHKsjL7oloIVhy-8yC-0ToVhthOtNWPbvj7JNpQPGDKL4myam-ZwSKu_XJvmzn7LiRs5HucuD2Y8aeASy3BH6G; passport_auth_mix_state=l77prm6nsshqvnosgn6phiguctwozx2h; passport_mfa_token=CjUpVNetvpB8Zr1jZ2tbtInUu38uUWEvjROrAsVcmkMpmk9I5M8B0mNz0oEvbuGjuQF1CQtF4BpKCjwtGudUs%2BSswQPE11KonfIvva%2BR7rYcYQCWQbosDQsJqBhxE752x56MMscPL1VmmkDXmaqHZlDWDiOVutQQr4PjDRj2sdFsIAIiAQOcqBrs; d_ticket=ddee2028b8cf6666247e3c9272741fbdf9b5c; passport_assist_user=Cj2R92G3UV6xb-jmf4xxvJn9rGYhyqNoeb5ZSpOx_Q2bucZ4dHqM4hzWGUF-w-LjdYFC6pf-RxnE4DMztLwyGkoKPOe34cqvpZUziLeaq-Xv5U9l4jR_cjtOyCIoRKlgiVWeVaaM8cxcxAt5-eVtr1Oft8zr4nnFdghJhgLFZhDlguMNGImv1lQgASIBA9NkpvA%3D; n_mh=uMdSiFmP8i2dWj6705vGWkn9--naSG-Lx121BtF2X_U; sso_uid_tt=5783a2886eed7c61f2db7d24b6c405de; sso_uid_tt_ss=5783a2886eed7c61f2db7d24b6c405de; toutiao_sso_user=e3c58d87b0bad2ebe435a00058dfdd0c; toutiao_sso_user_ss=e3c58d87b0bad2ebe435a00058dfdd0c; sid_ucp_sso_v1=1.0.0-KGMzNDY2ODNkYzM3N2UyMTk5ZmU2ZjE2MTcyNmJlNTdjNGFhOGY3YWUKHwiqiJL99wIQl-21ugYY7zEgDDCNotLZBTgGQPQHSAYaAmxxIiBlM2M1OGQ4N2IwYmFkMmViZTQzNWEwMDA1OGRmZGQwYw; ssid_ucp_sso_v1=1.0.0-KGMzNDY2ODNkYzM3N2UyMTk5ZmU2ZjE2MTcyNmJlNTdjNGFhOGY3YWUKHwiqiJL99wIQl-21ugYY7zEgDDCNotLZBTgGQPQHSAYaAmxxIiBlM2M1OGQ4N2IwYmFkMmViZTQzNWEwMDA1OGRmZGQwYw; login_time=1733129879643; passport_auth_status=52cb51f862f9f9b8ebaf0776aa492051%2C; passport_auth_status_ss=52cb51f862f9f9b8ebaf0776aa492051%2C; uid_tt=a68f5506ce7d5e57aebf0fa0e442282f; uid_tt_ss=a68f5506ce7d5e57aebf0fa0e442282f; sid_tt=b1a080f6bf22a258d2e4b56893e0be43; sessionid=b1a080f6bf22a258d2e4b56893e0be43; sessionid_ss=b1a080f6bf22a258d2e4b56893e0be43; is_staff_user=false; __ac_nonce=0674d769900d5331733a5; SelfTabRedDotControl=%5B%5D; FOLLOW_LIVE_POINT_INFO=%22MS4wLjABAAAASmPmcSDRbNaw1E1RDCQkwWeYoTNcpq02bL4GM1_9u_Y%2F1733155200000%2F0%2F1733129894052%2F0%22; _bd_ticket_crypt_doamin=2; _bd_ticket_crypt_cookie=74e5bf5e06aeb90df2e2297b72556239; __security_server_data_status=1; publish_badge_show_info=%220%2C0%2C0%2C1733129895728%22; xg_device_score=7.90435294117647; sid_guard=b1a080f6bf22a258d2e4b56893e0be43%7C1733129897%7C5183985%7CFri%2C+31-Jan-2025+08%3A58%3A02+GMT; sid_ucp_v1=1.0.0-KDZmZmY2Yjc3OTE2NzYyMDBhNjkzYjgwOGIwMDg0ZTIwNjA1YTJmNzMKGQiqiJL99wIQqe21ugYY7zEgDDgGQPQHSAQaAmxxIiBiMWEwODBmNmJmMjJhMjU4ZDJlNGI1Njg5M2UwYmU0Mw; ssid_ucp_v1=1.0.0-KDZmZmY2Yjc3OTE2NzYyMDBhNjkzYjgwOGIwMDg0ZTIwNjA1YTJmNzMKGQiqiJL99wIQqe21ugYY7zEgDDgGQPQHSAQaAmxxIiBiMWEwODBmNmJmMjJhMjU4ZDJlNGI1Njg5M2UwYmU0Mw; biz_trace_id=2826297d; store-region=cn-sc; store-region-src=uid; IsDouyinActive=true; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1536%2C%5C%22screen_height%5C%22%3A864%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A16%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A10%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A100%7D%22; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCS2YzdFFHZ3RBaU9ReGlkcDlKeTVmc3pGSit3T01KWTV2MUk0VXZoMGlHekl3TUovcWhkU0JtUW1UUWxsOWxyWmhyMG1ZZkpjZ2kwQ3Foa2ZRcDVac0E9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoyfQ%3D%3D; passport_fe_beating_status=true; stream_player_status_params=%22%7B%5C%22is_auto_play%5C%22%3A0%2C%5C%22is_full_screen%5C%22%3A0%2C%5C%22is_full_webscreen%5C%22%3A0%2C%5C%22is_mute%5C%22%3A1%2C%5C%22is_speed%5C%22%3A1%2C%5C%22is_visible%5C%22%3A1%7D%22; home_can_add_dy_2_desktop=%221%22; odin_tt=7ea8d2b5a709e547be1dc6228fbb1f6042a13e8e141089d96afc69ad3a4e50cc04bd21b49ef106f9d9b4a07724aca74c")
                .addHeader("referer","https://www.douyin.com/")
                .build();
        try {
            Response response = HttpUtils.client.newCall(request).execute();//发送请求
            String result = Objects.requireNonNull(response.body()).string();
            JSONObject jsonObject = new JSONObject(result);
            JSONArray awemeList = jsonObject.getJSONArray("aweme_list");
            for (int i = 0; i < awemeList.length(); i++) {
                JSONObject item = awemeList.getJSONObject(i);
                if(!item.isNull("video")){
                    JSONObject video = item.getJSONObject("video");

                    JSONObject playAddr = video.getJSONObject("play_addr");
                    JSONArray urlList = playAddr.getJSONArray("url_list");
                    String videoSrc = urlList.getString(2);
                    System.err.println(videoSrc);
                }
            }
        }  catch (Exception e) {
            e.printStackTrace();
        }
    }


    @Test
    void test02(){
        // 创建 WebClient 实例
        String url = "https://www.douyin.com/aweme/v1/play/?video_id=v0d00fg10000ct6m03vog65s5t566190&line=0&file_id=66ee823326a94af0a15619bbb61602b9&sign=023a60a587dc6e309798633cd852fe6f&is_play_url=1&source=PackSourceEnum_FEED";

        WebClient webClient = WebClient.builder()
                .baseUrl(url)
                .defaultHeader("accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7")
                .defaultHeader("accept-encoding", "gzip, deflate, br, zstd")
                .defaultHeader("accept-language", "zh-CN,zh;q=0.9")
                .defaultHeader("priority", "u=0, i")
                .defaultHeader("sec-ch-ua", "\"Google Chrome\";v=\"131\", \"Chromium\";v=\"131\", \"Not_A Brand\";v=\"24\"")
                .defaultHeader("sec-ch-ua-mobile", "?0")
                .defaultHeader("sec-ch-ua-platform", "\"Windows\"")
                .defaultHeader("sec-fetch-dest", "document")
                .defaultHeader("sec-fetch-mode", "navigate")
                .defaultHeader("sec-fetch-site", "none")
                .defaultHeader("sec-fetch-user", "?1")
                .defaultHeader("upgrade-insecure-requests", "1")
                .defaultHeader("user-agent", HttpUtils.randomUA("windows"))
                .defaultHeader("cookie", "s_v_web_id=verify_m49fh1z8_h9qgl1UQ_eDx4_4Kzx_9T3Q_VdjBm76IkXvF; __ac_nonce=0674fe3dd000f94e42b01; __ac_signature=_02B4Z6wo00f01ycsmQgAAIDC-HdqRY.Gbo8nDJ2AAK6Pd2; ttwid=1%7CY-ASPIdXQIYDERhO0F6DTdl9zf7NXCcP9NzUc3PJxeQ%7C1733288926%7Cf42adccb848c722f27814af3b06aeb009c5bbf0ce7b1c6a0820d315356762bdc; UIFID_TEMP=c4a29131752d59acb78af076c3dbdd52744118e38e80b4b96439ef1e20799db0821d02176388b15e3f30a26ce1d42517ef9fdc485c835950c69508f5e6d656147a54c77d5fb48e4f6a79d639416b6be042ea229d0cc92ea694fa96aa94e13e4e7fd94ee431fc24390f0780b18dd0e708; hevc_supported=true; my_rd=2; dy_swidth=1536; dy_sheight=864; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1536%2C%5C%22screen_height%5C%22%3A864%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A16%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A10%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A200%7D%22; csrf_session_id=b195702ee020434f8829f06b201fb538; fpk1=U2FsdGVkX19l6kDnPJVUS280RegB2iMj2yfOR258OJLBAgLPyGecAlNJXgoM99c/6mAXpB8uEh8p4Ka+lq5DHw==; fpk2=f51bb482c660d0eeadd1f058058a2b35; bd_ticket_guard_client_web_domain=2; UIFID=c4a29131752d59acb78af076c3dbdd52744118e38e80b4b96439ef1e20799db0821d02176388b15e3f30a26ce1d42517ef9fdc485c835950c69508f5e6d656147c919eea61b3446ffa459e7d9ab032ebff559114aad96a4a39ae295307670e17a402777089aedf7bf4291cf24ae9bc282d744fc55574e9d784c0f809d39b0ef155103b96cc599caf676c4cc6e3cc2b9dac2e1aef3ca62f97dec56ed9bc678704e062d58cf94b2507c89d743fc48c57069661e769ea15f6e3aa7e48afddf46c39; douyin.com; xg_device_score=7.631555165619236; device_web_cpu_core=16; device_web_memory_size=8; architecture=amd64; is_dash_user=1; home_can_add_dy_2_desktop=%221%22; strategyABtestKey=%221733288931.907%22; FORCE_LOGIN=%7B%22videoConsumedRemainSeconds%22%3A180%7D; volume_info=%7B%22isUserMute%22%3Afalse%2C%22isMute%22%3Atrue%2C%22volume%22%3A0.5%7D; xgplayer_user_id=942378509361; passport_csrf_token=8f828bcce63db47eb8bbbf4df9e2e47c; passport_csrf_token_default=8f828bcce63db47eb8bbbf4df9e2e47c; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCS2YzdFFHZ3RBaU9ReGlkcDlKeTVmc3pGSit3T01KWTV2MUk0VXZoMGlHekl3TUovcWhkU0JtUW1UUWxsOWxyWmhyMG1ZZkpjZ2kwQ3Foa2ZRcDVac0E9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoyfQ%3D%3D; biz_trace_id=1728be45; sdk_source_info=7e276470716a68645a606960273f276364697660272927676c715a6d6069756077273f276364697660272927666d776a68605a607d71606b766c6a6b5a7666776c7571273f275e58272927666a6b766a69605a696c6061273f27636469766027292762696a6764695a7364776c6467696076273f275e5827292771273f27333c3636363c3d3d37363632342778; bit_env=Mc7WSP6dFv-37P397EFqkHShuzkZbgpL0PrUjYJjCupJKSCVIAXgAVurpxSmZ3qdwdhkhIrrCacmhl9RrWIHpZrRI115bzcxopxEcNpYLDFJFf3jAqsn-9PZ1GDBbu7nsWhjyy_Jr66YvcvzNEG_Hyy7EqMRxZwqzsStm5t5MYGGsh2cybIDgdZ4XS2SepMTu5IaK58Fc9-C8bJywtw1ws6HWAImAqNxNZ7odTKJ-5T7Svz6jKadQyx30LG7VNH4K8IbhblEWDB8uWFA2LepGrAedp9aH-xJkMdn5PUFRFsv9go-b2rejB50BlbuAqEM0PEuX_2vGwD2mDJqjfNqFufKqDidiMIcY17rmGq0EXpoW5icAGFFLcAGqMd_gecaYTUnXlt_bnQTcn7qvriFoVNCFhvq524Jstg0zl8iK7VPLR-t__KtyRjhrNV7dPfd323LZCfV6dzGc--niLzq9DYOFX7kdJ2ZmX-57ZrOHqKRny7r5eOVAwHC-bgBwcHS; gulu_source_res=eyJwX2luIjoiNGEyZmE1ZTg5YTg1M2ViNDJiOTRmMzNjODI3MThlYzAyMDdmNDc5ZjdhYTgxNmE5ZjlmZmNjNmI3OGFhZWZmNiJ9; passport_auth_mix_state=mn5u733nmjyxq37dfo6utcz15kfv3f9odb7bs4yinwb7ss1u; IsDouyinActive=false; stream_player_status_params=%22%7B%5C%22is_auto_play%5C%22%3A0%2C%5C%22is_full_screen%5C%22%3A0%2C%5C%22is_full_webscreen%5C%22%3A0%2C%5C%22is_mute%5C%22%3A1%2C%5C%22is_speed%5C%22%3A1%2C%5C%22is_visible%5C%22%3A0%7D%22")
                .build();

        Mono<String> responseMono = webClient.get()
                .uri(url)
                .retrieve()
                .toEntity(String.class)
                .flatMap(responseEntity -> {
                    // 检查响应头中的 Location 字段
                    HttpHeaders headers = responseEntity.getHeaders();
                    String finalUrl = headers.getLocation() != null ? headers.getLocation().toString() : "No redirect";
                    System.out.println("Final URL: " + finalUrl);
                    return Mono.just(finalUrl);
                })
                .onErrorResume(e -> {
                    System.err.println("Request failed: " + e.getMessage());
                    return Mono.just("Request failed");
                });

        // 阻塞调用以获取结果（仅用于演示）
        String result = responseMono.block();
        System.out.println("Result: " + result);
    }

}
